  
<% layout ("/layouts/boilerplate") %>
<body>
    <div class="filterss">
    <a href="/listings?category=Trending" class="filter-link">
       <div class="filter ms-4">
        <div><i class="fa-solid fa-fire"></i></div>
        <p>Trending </p>
       </div>
        </a>
    <a href="/listings?category=Rooms" class="filter-link">
       <div class="filter ms-4">
        <div><i class="fa-solid fa-bed"></i></div>
        <p>Rooms</p>
       </div>
        </a>
    <a href="/listings?category=Amazing Views" class="filter-link">
       <div class="filter ms-4">
        <div><i class="fa-solid fa-mountain-sun"></i></div>
        <p>Amazing Views</p>
       </div>       
        </a>
    <a href="/listings?category=Iconic cities" class="filter-link">
       <div class="filter ms-4">
        <div><i class="fa-solid fa-mountain-city"></i></div>
        <p>Iconic cities</p>
       </div>
        </a>
    <a href="/listings?category=Surfing" class="filter-link">
       <div class="filter ms-4">
        <div><i class="fa-solid fa-football"></i></div>
        <p>Surfing</p>
       </div>
        </a>
    <a href="/listings?category=Amazing Pools" class="filter-link">
       <div class="filter ms-4">
        <div><i class="fa-solid fa-person-swimming"></i></div>
        <p>Amazing Pools</p>
       </div> 
             </a>
    <a href="/listings?category=Beach" class="filter-link">
       <div class="filter ms-4">
        <div><i class="fa-solid fa-umbrella-beach"></i></div>
        <p>Beach</p>
       </div>
        </a>
    <a href="/listings?category=Cabins" class="filter-link">
       <div class="filter ms-4">
        <div><i class="fa-solid fa-chalkboard"></i></div>
        <p>Cabins</p>
       </div>
        </a>
    <a href="/listings?category=Lake front" class="filter-link">
       <div class="filter ms-4">
        <div><i class="fa-solid fa-water"></i></div>
        <p>Lake front</p>
       </div>   
        </a>

    <a href="/listings?category=Pool" class="filter-link">
       <div class="filter ms-4">
        <div><i class="fa-solid fa-snowflake"></i></div>
        <p>Pool</p>
       </div> </a>
        
          <div class="tax-switch ms-auto">
        <div class="form-check-reverse form-switch">
              <input class="form-check-input mt-2" type="checkbox" role="switch" id="switchCheckDefault">
               <label class="form-check-label" for="switchCheckDefault"><b>See Offers</b></label>
             </div>
      </div>     
   </div>
     <div class="tax-bar">
           
       </div>   
<!-- jsjc ai -->
 <button id="show-chat-btn" class="btn btn-primary" style="position:fixed;background-color: black; bottom:150px; right:35.5px; z-index:10000;">
  Chat with AI
</button>
       <div class="chat-container">
  <div class="chat-header">
       <button id="minimize-chat-btn" style="float:right; background:white;border-radius:30%; color:black; font-size:0.7em; cursor:pointer;">&#8212;</button>

    <h2>Rishabh AI Guide</h2>
  </div>
  <div class="chat-window" id="chat-window">
    <div class="message ai-message">
      <p>Hi there! I'm Rishabh,lets dive into my amazing project,i am your guide to amazing travel destinations. How can I help you plan your next adventure?</p>
    </div>
  </div>
  <div class="chat-input-area">
    <input type="text" id="message-input" placeholder="Ask about a destination..." />
    <button id="send-btn">Send</button>
  </div>
</div>


<style>
  .chat-container {
    /* display: none; Hide by default */
      opacity: 0;
    visibility: hidden;
    transform: translateY(40px);
    transition: opacity 0.3s ease, transform 0.3s ease;

    width: 350px;
    position: fixed;
    bottom: 30px;
    right: 20px;
    border: 1px solid #ccc;
    border-radius: 10px;
    font-family: sans-serif;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    background-color: #fff;
    overflow: hidden; /* Ensures child elements conform to border-radius */
      
    z-index: 9999;
  }
  .chat-container.active {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
  }
  .chat-header {
    background-color:#fe424d;
    color: white;
    padding: 10px;
    text-align: center;
  }
  .chat-header h2 {
    margin: 0;
    font-size: 1.1em;
  }
  .chat-window {
    height: 400px;
    padding: 10px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 10px;
    /* background-color: #de9c9c; */
    
  }
  .message {
    padding: 8px 12px;
    border-radius: 18px;
    max-width: 80%;
    line-height: 1.4;
  }
  .user-message {
    background-color: #fe424d;
    color: white;
    align-self: flex-end; /* Aligns user messages to the right */
  }
  .ai-message {
    background-color: #f1f1f1;
    color: #333;
    align-self: flex-start; /* Aligns AI messages to the left */
  }
  .chat-input-area {
    display: flex;
    padding: 10px;
    border-top: 1px solid #ccc;
   
  }
  #message-input {
    flex-grow: 1;
    border: 2px solid #de9c9c;
    border-radius: 20px;
    padding: 10px;
    font-size: 1em;
  }
  #send-btn {
    background-color: #fe424d;
    color: white;
    border: none;
    padding: 0 15px;
    border-radius: 20px;
    margin-left: 10px;
    cursor: pointer;
  }
  #send-btn:hover {
    background-color:#ac141efe;
    border-radius: 30px;
  }
</style>
<!-- ai -->
 <!-- <script>
  const showChatBtn = document.getElementById('show-chat-btn');
  const chatContainer = document.querySelector('.chat-container');

  showChatBtn.addEventListener('click', () => {
    chatContainer.style.display = 'block';
    showChatBtn.style.display = 'none'; // Hide the button after opening chat
  });
</script> -->
<!-- button with minimize and maximize feature  -->
 <!-- <script>
  const showChatBtn = document.getElementById('show-chat-btn');
  const chatContainer = document.querySelector('.chat-container');
  const minimizeChatBtn = document.getElementById('minimize-chat-btn');

  showChatBtn.addEventListener('click', () => {
    chatContainer.style.display = 'block';
    showChatBtn.style.display = 'none';
  });

  minimizeChatBtn.addEventListener('click', () => {
    chatContainer.style.display = 'none';
    showChatBtn.style.display = 'block';
  });
  </script> -->
  <!-- for smooth transition -->
   <script>
  const showChatBtn = document.getElementById('show-chat-btn');
  const chatContainer = document.querySelector('.chat-container');
  const minimizeChatBtn = document.getElementById('minimize-chat-btn');

  showChatBtn.addEventListener('click', () => {
    chatContainer.classList.add('active');
    showChatBtn.style.display = 'none';
  });

  minimizeChatBtn.addEventListener('click', () => {
    chatContainer.classList.remove('active');
    showChatBtn.style.display = 'block';
  });

</script>
 <!-- chat container btton code -->

    <div class="row  row-cols-lg-3 mt-3 row-cols-md- row-cols-sm-1">
     <% for (let listingg of alllisting) { %>
        <a href="/listings/<%=listingg._id%>" class="listing-link">
 
            <div class="card listing-card" >
  <img src="<%=listingg.image.url%>" class="card-img-top" alt="listing_cardimage"  style="height:20rem;">   
   <div class="card-image-overlay">    </div>
  <div class="card-body">
    <h5 class="card-title"><b><%=listingg.title%></b></h5>
    <p>&#8377;<%= typeof listingg.price === "number" ? listingg.price.toLocaleString("en-IN") : listingg.price %>/Night 
        <% if(listingg.price>5000){ %><b> <i class="tax-info">&nbsp; &nbsp; +50% Off</i></b>
         <% }else if(listingg.price>1000 && listingg.price<4999){ %><b> <i class="tax-info">&nbsp; &nbsp; +18% Off</i></b><% } %></p>     
  
</div> 
</div>   
</a>         
      <% } %> </div>          
   
<script>
    let taxbutton=document.getElementById("switchCheckDefault");
    taxbutton.addEventListener("click",()=>{
       let taxinfo=document.getElementsByClassName("tax-info");
       console.log(taxinfo);
       //so on click pr dene ke liye hm loop lagayenge 
       for(info of taxinfo){
        if(info.style.display !="inline"){
            info.style.display="inline";
        }else{
         info.style.display="none";
    
        }
       }
    })
</script>
<!-- ai -->
<script>
  // Get the elements from the HTML
  const chatWindow = document.getElementById('chat-window');
  const messageInput = document.getElementById('message-input');
  const sendButton = document.getElementById('send-btn');

  
  //test link

  // !!! IMPORTANT: PASTE YOUR N8N PRODUCTION URL HERE !!!
 //const n8nWebhookUrl = 'https://production-3ebdb.up.railway.app/webhook-test/ed4e54fa-62fe-45ef-84bb-79e4b74533e9'; // <--- PASTE YOUR URL HERE


//Production Link

 const n8nWebhookUrl = 'https://primary-production-3ebdb.up.railway.app/webhook/ed4e54fa-62fe-45ef-84bb-79e4b74533e9';


  // Function to send a message
  async function sendMessage() {
    const userMessageText = messageInput.value.trim();

    if (userMessageText === '') {
      return; // Don't send empty messages
    }

    // 1. Display the user's message immediately
    displayMessage(userMessageText, 'user');
    messageInput.value = ''; // Clear the input box

    try {
      // 2. Send the message to your n8n webhook
      const response = await fetch(n8nWebhookUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ message: userMessageText }), // This key 'message' must match what your n8n workflow expects
      });

      if (!response.ok) {
        throw new Error('Network response was not ok');
      }

      const aiResponse = await response.json(); // Assumes n8n sends back a JSON object like { "response_text": "Hello!" }

      // 3. Display the AI's response
      // Adjust aiResponse.key based on how you configured your n8n "Respond to Webhook" node
      displayMessage(aiResponse.output, 'ai'); 

    } catch (error) {
      console.error('Error:', error);
      displayMessage('Sorry, something went wrong. Please try again.', 'ai');
    }
  }

  // Function to add a message to the chat window
  function displayMessage(text, sender) {
    const messageElement = document.createElement('div');
    messageElement.classList.add('message', `${sender}-message`);
    
    const paragraph = document.createElement('p');
    paragraph.textContent = text;
    messageElement.appendChild(paragraph);

    chatWindow.appendChild(messageElement);
    chatWindow.scrollTop = chatWindow.scrollHeight; // Auto-scroll to the latest message
  }

  // Event Listeners
  sendButton.addEventListener('click', sendMessage);
  messageInput.addEventListener('keypress', function(event) {
    if (event.key === 'Enter') {
      sendMessage();
    }
  });
</script>
<!-- ai -->
</body>
